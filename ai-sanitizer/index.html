<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Sanitizer — Strip PII Before Prompting | devhandbook.io</title>
    <meta name="description" content="Remove personal identifiable information (PII) from text before pasting into AI tools. Masks account numbers, SSNs, emails, phone numbers, and more. 100% client-side — nothing leaves your browser.">
    <meta name="keywords" content="PII scrubber, AI sanitizer, remove personal data, banking compliance, data masking, account number redaction, SSN removal, GDPR, privacy tool">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="AI Text Sanitizer — devhandbook.io">
    <meta property="og:description" content="Strip PII from text before using AI tools. Account numbers, SSNs, emails, phone numbers — all masked client-side.">
    <meta property="og:type" content="website">
    <link rel="canonical" href="https://devhandbook.io/ai-sanitizer/">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BQXTZYP8H4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-BQXTZYP8H4');
    </script>
    <script>
        (function() {
            var d = document.documentElement;
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                d.classList.add('dark');
            }
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { DEFAULT: '#0071e3', dark: '#0077ed' }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../apple-redesign.css">
    <style>
        .mono { font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace; }

        /* PII highlight colors */
        .pii-ssn { background: rgba(255, 69, 58, 0.15); color: #ff453a; border-radius: 4px; padding: 1px 4px; }
        .pii-account { background: rgba(255, 159, 10, 0.15); color: #ff9f0a; border-radius: 4px; padding: 1px 4px; }
        .pii-card { background: rgba(191, 90, 242, 0.15); color: #bf5af2; border-radius: 4px; padding: 1px 4px; }
        .pii-routing { background: rgba(48, 209, 88, 0.15); color: #30d158; border-radius: 4px; padding: 1px 4px; }
        .pii-phone { background: rgba(0, 113, 227, 0.15); color: #0071e3; border-radius: 4px; padding: 1px 4px; }
        .pii-email { background: rgba(90, 200, 250, 0.15); color: #5ac8fa; border-radius: 4px; padding: 1px 4px; }
        .pii-dob { background: rgba(255, 55, 95, 0.15); color: #ff375f; border-radius: 4px; padding: 1px 4px; }
        .pii-name { background: rgba(100, 210, 255, 0.15); color: #64d2ff; border-radius: 4px; padding: 1px 4px; }
        .pii-address { background: rgba(172, 142, 104, 0.15); color: #ac8e68; border-radius: 4px; padding: 1px 4px; }
        .pii-dollar { background: rgba(48, 209, 88, 0.12); color: #30d158; border-radius: 4px; padding: 1px 4px; }

        /* Toggle switches */
        .toggle-track {
            width: 44px;
            height: 26px;
            background: rgba(0,0,0,0.12);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: background 0.28s cubic-bezier(0.25,0.1,0.25,1);
            flex-shrink: 0;
        }
        .toggle-track.active {
            background: #30d158;
        }
        .toggle-thumb {
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.28s cubic-bezier(0.25,0.1,0.25,1);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .toggle-track.active .toggle-thumb {
            transform: translateX(18px);
        }
        html.dark .toggle-track {
            background: rgba(255,255,255,0.12);
        }
        html.dark .toggle-track.active {
            background: #30d158;
        }

        /* Stats pill */
        .stat-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: var(--accent-dim, rgba(0,113,227,0.1));
            border-radius: 980px;
            font-size: 13px;
            font-weight: 500;
            color: var(--accent, #0071e3);
        }

        /* Preview area */
        .preview-area {
            font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.7;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* Legend dots */
        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        /* Related Tools - Apple Style */
        .related-tool-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px 20px;
            background: var(--surface, rgba(255,255,255,0.82));
            border: 1px solid var(--glass-border, rgba(255,255,255,0.45));
            border-radius: 16px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.04);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            text-decoration: none;
            transition: transform 0.28s cubic-bezier(0.25,0.1,0.25,1), box-shadow 0.28s cubic-bezier(0.25,0.1,0.25,1);
        }
        .related-tool-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.11), 0 2px 8px rgba(0,0,0,0.06);
        }
        html.dark .related-tool-card {
            background: rgba(28,28,30,0.9);
            border-color: rgba(255,255,255,0.1);
        }
        .related-tool-icon {
            width: 48px; height: 48px;
            background: rgba(0,113,227,0.1);
            color: #0071e3;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 13px; letter-spacing: -0.01em; flex-shrink: 0;
        }
        html.dark .related-tool-icon { background: rgba(41,151,255,0.12); color: #2997ff; }
        .related-tool-card h3 { font-size: 15px; font-weight: 600; color: var(--text-primary, #1d1d1f); letter-spacing: -0.01em; }
        html.dark .related-tool-card h3 { color: #f5f5f7; }
        .related-tool-card p { font-size: 13px; color: var(--text-secondary, #6e6e73); margin-top: 2px; }
        html.dark .related-tool-card p { color: #98989d; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-black min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 dark:bg-black/80 backdrop-blur-xl border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="../" class="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors flex items-center gap-1 text-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    Tools
                </a>
                <div class="border-r border-gray-200 dark:border-gray-700 h-6"></div>
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-xl flex items-center justify-center text-white text-sm font-bold" style="background:#0071e3">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="9" y1="12" x2="15" y2="12"/></svg>
                    </div>
                    <div>
                        <h1 class="text-base font-semibold text-gray-900 dark:text-white" style="letter-spacing:-0.02em">AI Text Sanitizer</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Strip PII before prompting</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="hidden sm:inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium rounded-full" style="background:var(--accent-dim, rgba(0,113,227,0.1)); color:var(--accent, #0071e3)">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                    Client-side only
                </span>
                <button id="themeToggle" onclick="toggleTheme()" class="p-2 rounded-full border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <svg id="sunIcon" class="w-4 h-4 hidden text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                    <svg id="moonIcon" class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="max-w-5xl mx-auto px-4 py-10">

        <!-- Privacy notice -->
        <div class="mb-8 rounded-2xl p-5 flex items-start gap-3" style="background:var(--accent-dim, rgba(0,113,227,0.1)); border:1px solid rgba(0,113,227,0.12)">
            <svg class="w-5 h-5 mt-0.5 flex-shrink-0" style="color:var(--accent, #0071e3)" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            <div>
                <p class="text-sm font-semibold" style="color:var(--text-primary, #1d1d1f)">Your data never leaves this device</p>
                <p class="text-sm mt-1" style="color:var(--text-secondary, #6e6e73)">All detection and masking runs entirely in your browser. No server calls, no logging, no data collection. Safe for GLBA, HIPAA, and GDPR-regulated environments.</p>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-white dark:bg-gray-800 rounded-xl mb-6 overflow-hidden">
            <div class="px-5 py-4 border-b border-gray-100 dark:border-gray-700">
                <div class="flex items-center justify-between flex-wrap gap-3">
                    <h2 class="text-base font-semibold text-gray-900 dark:text-white" style="letter-spacing:-0.02em">Detection Rules</h2>
                    <div class="flex items-center gap-2">
                        <button onclick="enableAll()" class="px-3 py-1.5 text-xs font-medium rounded-full" style="background:var(--accent-dim); color:var(--accent)">Enable All</button>
                        <button onclick="disableAll()" class="px-3 py-1.5 text-xs font-medium rounded-full border" style="border-color:var(--border, rgba(0,0,0,0.07)); color:var(--text-secondary, #6e6e73)">Disable All</button>
                    </div>
                </div>
            </div>
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-0 divide-y sm:divide-y-0 divide-gray-100 dark:divide-gray-700">
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#ff453a"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">SSN</span>
                    </div>
                    <div class="toggle-track active" data-rule="ssn" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700 lg:border-r">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#ff9f0a"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Account Numbers</span>
                    </div>
                    <div class="toggle-track active" data-rule="account" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700 lg:border-r-0">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#bf5af2"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Credit Cards</span>
                    </div>
                    <div class="toggle-track active" data-rule="card" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#30d158"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Routing Numbers</span>
                    </div>
                    <div class="toggle-track active" data-rule="routing" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700 lg:border-r">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#0071e3"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Phone Numbers</span>
                    </div>
                    <div class="toggle-track active" data-rule="phone" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700 lg:border-r-0">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#5ac8fa"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Email Addresses</span>
                    </div>
                    <div class="toggle-track active" data-rule="email" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#ff375f"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Dates (DOB)</span>
                    </div>
                    <div class="toggle-track active" data-rule="dob" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors sm:border-r border-gray-100 dark:border-gray-700 lg:border-r">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#30d158"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Dollar Amounts</span>
                    </div>
                    <div class="toggle-track" data-rule="dollar" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
                <label class="flex items-center justify-between gap-3 px-5 py-3.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors">
                    <div class="flex items-center gap-2.5">
                        <span class="legend-dot" style="background:#ac8e68"></span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">Street Addresses</span>
                    </div>
                    <div class="toggle-track active" data-rule="address" onclick="toggleRule(this, event)"><div class="toggle-thumb"></div></div>
                </label>
            </div>
        </div>

        <!-- Input -->
        <div class="bg-white dark:bg-gray-800 rounded-xl mb-6 overflow-hidden">
            <div class="px-5 py-3.5 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between">
                <h2 class="text-sm font-semibold text-gray-900 dark:text-white">Input — Paste text containing PII</h2>
                <div class="flex items-center gap-2">
                    <button onclick="loadExample()" class="px-3 py-1.5 text-xs font-medium rounded-full" style="background:var(--accent-dim); color:var(--accent)">Load Example</button>
                    <button onclick="clearInput()" class="px-3 py-1.5 text-xs font-medium rounded-full border" style="border-color:var(--border); color:var(--text-secondary)">Clear</button>
                </div>
            </div>
            <textarea id="inputText" class="w-full p-5 text-sm bg-transparent border-0 resize-none focus:ring-0 focus:outline-none mono" rows="8" placeholder="Paste your text here. Customer notes, emails, chat logs — anything with PII you need to strip before sending to an AI tool.&#10;&#10;Example: Customer John Smith (SSN: 123-45-6789) called about account #4532891076 ..." oninput="sanitize()"></textarea>
        </div>

        <!-- Stats -->
        <div id="statsBar" class="mb-6 flex items-center gap-3 flex-wrap" style="display:none">
            <span class="stat-pill" id="totalStat">0 items detected</span>
            <div id="categoryStats" class="flex items-center gap-2 flex-wrap"></div>
        </div>

        <!-- Output -->
        <div class="bg-white dark:bg-gray-800 rounded-xl mb-6 overflow-hidden">
            <div class="px-5 py-3.5 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between">
                <h2 class="text-sm font-semibold text-gray-900 dark:text-white">Sanitized Output</h2>
                <div class="flex items-center gap-2">
                    <button id="previewBtn" onclick="togglePreview()" class="px-3 py-1.5 text-xs font-medium rounded-full border" style="border-color:var(--border); color:var(--text-secondary)">Show Preview</button>
                    <button onclick="copySanitized()" class="px-3 py-1.5 text-xs font-medium rounded-full text-white" style="background:var(--accent)">
                        <span id="copyLabel">Copy Clean Text</span>
                    </button>
                </div>
            </div>
            <div id="outputPlain">
                <textarea id="outputText" class="w-full p-5 text-sm bg-transparent border-0 resize-none focus:ring-0 focus:outline-none mono" rows="8" readonly placeholder="Sanitized text will appear here..."></textarea>
            </div>
            <div id="outputPreview" class="p-5 hidden">
                <div id="previewContent" class="preview-area text-sm text-gray-900 dark:text-white"></div>
            </div>
        </div>

        <!-- How it works -->
        <div class="bg-white dark:bg-gray-800 rounded-xl mb-10 overflow-hidden">
            <div class="px-5 py-4 border-b border-gray-100 dark:border-gray-700">
                <h2 class="text-base font-semibold text-gray-900 dark:text-white" style="letter-spacing:-0.02em">How It Works</h2>
            </div>
            <div class="grid sm:grid-cols-3 gap-0 divide-y sm:divide-y-0 sm:divide-x divide-gray-100 dark:divide-gray-700">
                <div class="p-5">
                    <div class="text-2xl mb-2">1</div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-1">Paste your text</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Customer notes, emails, chat logs — anything with sensitive data you need to use with AI.</p>
                </div>
                <div class="p-5">
                    <div class="text-2xl mb-2">2</div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-1">PII is detected & masked</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Regex patterns identify SSNs, account numbers, credit cards, emails, phone numbers, dates, and more.</p>
                </div>
                <div class="p-5">
                    <div class="text-2xl mb-2">3</div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-1">Copy & prompt safely</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">The sanitized text preserves context while replacing sensitive values with safe placeholders.</p>
                </div>
            </div>
        </div>

        <!-- Related Tools -->
        <section class="mt-12">
            <h2 class="text-xl font-semibold mb-6" style="letter-spacing:-0.02em; color:var(--text-primary, #1d1d1f)">Related Tools</h2>
            <div id="relatedTools" class="grid sm:grid-cols-2 gap-4"></div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="max-w-7xl mx-auto px-4 py-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-800 mt-8">
        <p>AI Text Sanitizer — Strip PII before using AI tools</p>
        <p class="mt-1 text-xs">Free tool. No data collection. Part of the <a href="../" class="text-primary hover:underline">devhandbook.io</a> network.</p>
    </footer>

    <script>
        // Theme handling
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');

        function updateThemeIcons() {
            if (document.documentElement.classList.contains('dark')) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
        updateThemeIcons();

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            updateThemeIcons();
        }

        // ─── Rules state ───────────────────────────────────────────────
        const rules = {
            ssn: true,
            account: true,
            card: true,
            routing: true,
            phone: true,
            email: true,
            dob: true,
            dollar: false,
            address: true
        };

        function toggleRule(el, event) {
            event.preventDefault();
            const rule = el.dataset.rule;
            rules[rule] = !rules[rule];
            el.classList.toggle('active', rules[rule]);
            sanitize();
        }

        function enableAll() {
            Object.keys(rules).forEach(k => rules[k] = true);
            document.querySelectorAll('.toggle-track').forEach(t => t.classList.add('active'));
            sanitize();
        }

        function disableAll() {
            Object.keys(rules).forEach(k => rules[k] = false);
            document.querySelectorAll('.toggle-track').forEach(t => t.classList.remove('active'));
            sanitize();
        }

        // ─── PII Detection Patterns ────────────────────────────────────
        const patterns = {
            ssn: {
                regex: /\b(\d{3}[-–]\d{2}[-–]\d{4})\b/g,
                mask: '[SSN-REDACTED]',
                label: 'SSN',
                cssClass: 'pii-ssn'
            },
            card: {
                // Credit cards: 13-19 digits, optionally separated by spaces/dashes
                regex: /\b(\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{1,4})\b/g,
                mask: '[CARD-REDACTED]',
                label: 'Card',
                cssClass: 'pii-card',
                validate: (match) => {
                    const digits = match.replace(/[\s-]/g, '');
                    if (digits.length < 13 || digits.length > 19) return false;
                    // Luhn algorithm
                    let sum = 0, alt = false;
                    for (let i = digits.length - 1; i >= 0; i--) {
                        let n = parseInt(digits[i], 10);
                        if (alt) { n *= 2; if (n > 9) n -= 9; }
                        sum += n;
                        alt = !alt;
                    }
                    return sum % 10 === 0;
                }
            },
            routing: {
                // ABA routing: 9 digits with checksum
                regex: /\b(\d{9})\b/g,
                mask: '[ROUTING-REDACTED]',
                label: 'Routing',
                cssClass: 'pii-routing',
                validate: (match) => {
                    // ABA checksum: 3(d1+d4+d7) + 7(d2+d5+d8) + (d3+d6+d9) mod 10 == 0
                    const d = match.split('').map(Number);
                    const sum = 3*(d[0]+d[3]+d[6]) + 7*(d[1]+d[4]+d[7]) + (d[2]+d[5]+d[8]);
                    return sum % 10 === 0 && d[0] <= 3;
                }
            },
            account: {
                // Account numbers: 8-17 digit sequences (after SSN/card/routing are handled)
                regex: /\b(\d{8,17})\b/g,
                mask: '[ACCT-REDACTED]',
                label: 'Account',
                cssClass: 'pii-account'
            },
            phone: {
                regex: /(\+?1[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}\b/g,
                mask: '[PHONE-REDACTED]',
                label: 'Phone',
                cssClass: 'pii-phone'
            },
            email: {
                regex: /\b[A-Za-z0-9._%+\-]+@[A-Za-z0-9.\-]+\.[A-Za-z]{2,}\b/g,
                mask: '[EMAIL-REDACTED]',
                label: 'Email',
                cssClass: 'pii-email'
            },
            dob: {
                // Dates: MM/DD/YYYY, MM-DD-YYYY, Month DD YYYY, etc.
                regex: /\b(?:(?:0?[1-9]|1[0-2])[\/\-](?:0?[1-9]|[12]\d|3[01])[\/\-](?:19|20)\d{2}|(?:January|February|March|April|May|June|July|August|September|October|November|December|Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\.?\s+\d{1,2},?\s+(?:19|20)\d{2})\b/gi,
                mask: '[DATE-REDACTED]',
                label: 'Date',
                cssClass: 'pii-dob'
            },
            dollar: {
                regex: /\$[\d,]+(?:\.\d{2})?\b/g,
                mask: '[AMOUNT-REDACTED]',
                label: 'Amount',
                cssClass: 'pii-dollar'
            },
            address: {
                // US street addresses: number + street name + type
                regex: /\b\d{1,6}\s+(?:[NSEW]\.?\s+)?(?:[A-Z][a-zA-Z]+\s+){1,3}(?:St(?:reet)?|Ave(?:nue)?|Blvd|Boulevard|Dr(?:ive)?|Ln|Lane|Rd|Road|Ct|Court|Pl(?:ace)?|Way|Cir(?:cle)?|Pkwy|Parkway|Ter(?:race)?)\.?\b/gi,
                mask: '[ADDRESS-REDACTED]',
                label: 'Address',
                cssClass: 'pii-address'
            }
        };

        // ─── Sanitize Logic ────────────────────────────────────────────
        let detections = [];

        function sanitize() {
            const input = document.getElementById('inputText').value;
            if (!input.trim()) {
                document.getElementById('outputText').value = '';
                document.getElementById('previewContent').innerHTML = '';
                document.getElementById('statsBar').style.display = 'none';
                return;
            }

            detections = [];
            let result = input;
            let previewResult = escapeHtml(input);

            // Process in order of specificity (SSN before account numbers, etc.)
            const order = ['ssn', 'card', 'email', 'phone', 'dob', 'dollar', 'address', 'routing', 'account'];

            // Track already-replaced positions to avoid double-matching
            let masked = new Set();

            for (const ruleKey of order) {
                if (!rules[ruleKey]) continue;
                const pattern = patterns[ruleKey];
                const regex = new RegExp(pattern.regex.source, pattern.regex.flags);
                let match;

                while ((match = regex.exec(input)) !== null) {
                    // Skip if this position was already masked by a higher-priority rule
                    let overlap = false;
                    for (let i = match.index; i < match.index + match[0].length; i++) {
                        if (masked.has(i)) { overlap = true; break; }
                    }
                    if (overlap) continue;

                    // Run validation if exists
                    if (pattern.validate && !pattern.validate(match[0])) continue;

                    // Mark positions
                    for (let i = match.index; i < match.index + match[0].length; i++) {
                        masked.add(i);
                    }

                    detections.push({
                        type: ruleKey,
                        value: match[0],
                        index: match.index,
                        length: match[0].length,
                        mask: pattern.mask,
                        label: pattern.label,
                        cssClass: pattern.cssClass
                    });
                }
            }

            // Sort by position (reverse to replace from end)
            detections.sort((a, b) => b.index - a.index);

            // Build sanitized output
            let sanitized = input;
            let preview = input;
            for (const d of detections) {
                sanitized = sanitized.substring(0, d.index) + d.mask + sanitized.substring(d.index + d.length);
            }

            document.getElementById('outputText').value = sanitized;

            // Build preview with highlights
            let previewText = escapeHtml(input);
            // Re-sort detections for preview (need to recalculate positions in escaped string)
            let previewSanitized = input;
            let offset = 0;
            const sortedDetections = [...detections].sort((a, b) => a.index - b.index);
            let previewHtml = '';
            let lastIdx = 0;
            for (const d of sortedDetections) {
                previewHtml += escapeHtml(input.substring(lastIdx, d.index));
                previewHtml += `<span class="${d.cssClass}">${d.mask}</span>`;
                lastIdx = d.index + d.length;
            }
            previewHtml += escapeHtml(input.substring(lastIdx));
            document.getElementById('previewContent').innerHTML = previewHtml;

            // Update stats
            updateStats();
        }

        function updateStats() {
            const statsBar = document.getElementById('statsBar');
            const totalStat = document.getElementById('totalStat');
            const categoryStats = document.getElementById('categoryStats');

            if (detections.length === 0) {
                statsBar.style.display = 'none';
                return;
            }

            statsBar.style.display = 'flex';
            totalStat.textContent = `${detections.length} item${detections.length !== 1 ? 's' : ''} redacted`;

            // Group by type
            const groups = {};
            detections.forEach(d => {
                groups[d.label] = (groups[d.label] || 0) + 1;
            });

            categoryStats.innerHTML = Object.entries(groups).map(([label, count]) =>
                `<span class="stat-pill" style="background:rgba(0,0,0,0.04); color:var(--text-secondary)">${count} ${label}</span>`
            ).join('');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ─── UI Actions ────────────────────────────────────────────────
        let previewMode = false;

        function togglePreview() {
            previewMode = !previewMode;
            document.getElementById('outputPlain').classList.toggle('hidden', previewMode);
            document.getElementById('outputPreview').classList.toggle('hidden', !previewMode);
            document.getElementById('previewBtn').textContent = previewMode ? 'Show Plain' : 'Show Preview';
        }

        function copySanitized() {
            const text = document.getElementById('outputText').value;
            if (!text) return;
            navigator.clipboard.writeText(text).then(() => {
                const label = document.getElementById('copyLabel');
                label.textContent = 'Copied!';
                setTimeout(() => label.textContent = 'Copy Clean Text', 1500);
            });
        }

        function clearInput() {
            document.getElementById('inputText').value = '';
            sanitize();
        }

        function loadExample() {
            document.getElementById('inputText').value = `Hi team,

Customer John Smith called regarding his checking account #4532891076. He mentioned that his direct deposit from Wells Fargo (routing 021000021) hasn't posted yet.

His contact info: john.smith@gmail.com, (610) 555-0147. DOB is 03/15/1987 and SSN on file is 482-39-7156.

He also asked about a charge of $2,847.93 on his Visa ending in 4532 0198 7612 3456. His mailing address is 1847 Oak Valley Dr, Allentown, PA 18104.

I told him we'd escalate to operations. Can someone pull up his profile and check the ACH trace? His wife Emma (SSN 291-55-8834) is a joint account holder.

Thanks,
Sarah`;
            sanitize();
        }

        // Dynamic Related Tools
        const allTools = [
            { id: 'json-formatter', name: 'JSON Formatter', desc: 'Pretty print, validate, and inspect JSON', icon: '{ }' },
            { id: 'jwt-debugger', name: 'JWT Debugger', desc: 'Decode headers and payloads instantly', icon: 'JWT' },
            { id: 'base64-converter', name: 'Base64 Converter', desc: 'Encode and decode with URL-safe support', icon: 'B64' },
            { id: 'timestamp-converter', name: 'Timestamp Converter', desc: 'Unix timestamps and human dates', icon: 'TIME' },
            { id: 'password-generator', name: 'Password Generator', desc: 'Strong passwords with complexity controls', icon: 'PASS' },
            { id: 'url-encoder', name: 'URL Encoder / Decoder', desc: 'Percent-encode and decode URLs', icon: 'URL' },
            { id: 'regex-tester', name: 'Regex Tester', desc: 'Test patterns with group matching', icon: 'REGX' },
            { id: 'html-entities', name: 'HTML Entities', desc: 'Convert and decode HTML entities', icon: 'HTML' },
            { id: 'color-converter', name: 'Color Converter', desc: 'Switch between HEX, RGB, and HSL', icon: 'CLR' },
            { id: 'cron-generator', name: 'Cron Generator', desc: 'Build and validate cron expressions', icon: 'CRON' },
            { id: 'pdf-tools', name: 'PDF Tool Suite', desc: 'Merge, split, compress, and protect PDFs', icon: 'PDF' }
        ];

        const pathParts = window.location.pathname.replace(/index\.html$/, '').split('/').filter(Boolean);
        const currentTool = pathParts[pathParts.length - 1] || '';
        const relatedEl = document.getElementById('relatedTools');
        if (relatedEl) {
            relatedEl.innerHTML = allTools
                .filter(t => t.id !== currentTool)
                .slice(0, 4)
                .map(t => `
                    <a href="../${t.id}/" class="related-tool-card">
                        <div class="related-tool-icon">${t.icon}</div>
                        <div>
                            <h3>${t.name}</h3>
                            <p>${t.desc}</p>
                        </div>
                    </a>
                `).join('');
        }
    </script>
</body>
</html>
